var e,t,n,i,r,o,l={},a=[],_=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord/i;function s(e,t){for(var n in t)e[n]=t[n];return e}function u(e){var t=e.parentNode;t&&t.removeChild(e)}function c(e,t,n){var i,r=arguments,o={};for(i in t)"key"!==i&&"ref"!==i&&(o[i]=t[i]);if(arguments.length>3)for(n=[n],i=3;i<arguments.length;i++)n.push(r[i]);if(null!=n&&(o.children=n),"function"==typeof e&&null!=e.defaultProps)for(i in e.defaultProps)void 0===o[i]&&(o[i]=e.defaultProps[i]);return h(e,o,t&&t.key,t&&t.ref,null)}function h(t,n,i,r,o){var l={type:t,props:n,key:i,ref:r,__k:null,__:null,__b:0,__e:null,__d:void 0,__c:null,constructor:void 0,__v:o};return null==o&&(l.__v=l),e.vnode&&e.vnode(l),l}function p(e){return e.children}function m(e,t){this.props=e,this.context=t}function d(e,t){if(null==t)return e.__?d(e.__,e.__.__k.indexOf(e)+1):null;for(var n;t<e.__k.length;t++)if(null!=(n=e.__k[t])&&null!=n.__e)return n.__e;return"function"==typeof e.type?d(e):null}function f(e){var t,n;if(null!=(e=e.__)&&null!=e.__c){for(e.__e=e.__c.base=null,t=0;t<e.__k.length;t++)if(null!=(n=e.__k[t])&&null!=n.__e){e.__e=e.__c.base=n.__e;break}return f(e)}}function g(o){(!o.__d&&(o.__d=!0)&&t.push(o)&&!n++||r!==e.debounceRendering)&&((r=e.debounceRendering)||i)(v)}function v(){for(var e;n=t.length;)e=t.sort((function(e,t){return e.__v.__b-t.__v.__b})),t=[],e.some((function(e){var t,n,i,r,o,l,a;e.__d&&(l=(o=(t=e).__v).__e,(a=t.__P)&&(n=[],(i=s({},o)).__v=i,r=R(a,o,i,t.__n,void 0!==a.ownerSVGElement,null,n,null==l?d(o):l),b(n,o),r!=l&&f(o)))}))}function y(e,t,n,i,r,o,_,s,c){var h,p,m,f,g,v,y,w=n&&n.__k||a,x=w.length;if(s==l&&(s=null!=o?o[0]:x?d(n,0):null),h=0,t.__k=T(t.__k,(function(n){if(null!=n){if(n.__=t,n.__b=t.__b+1,null===(m=w[h])||m&&n.key==m.key&&n.type===m.type)w[h]=void 0;else for(p=0;p<x;p++){if((m=w[p])&&n.key==m.key&&n.type===m.type){w[p]=void 0;break}m=null}if(f=R(e,n,m=m||l,i,r,o,_,s,c),(p=n.ref)&&m.ref!=p&&(y||(y=[]),m.ref&&y.push(m.ref,null,n),y.push(p,n.__c||f,n)),null!=f){var a;if(null==v&&(v=f),void 0!==n.__d)a=n.__d,n.__d=void 0;else if(o==m||f!=s||null==f.parentNode){e:if(null==s||s.parentNode!==e)e.appendChild(f),a=null;else{for(g=s,p=0;(g=g.nextSibling)&&p<x;p+=2)if(g==f)break e;e.insertBefore(f,s),a=s}"option"==t.type&&(e.value="")}s=void 0!==a?a:f.nextSibling,"function"==typeof t.type&&(t.__d=s)}else s&&m.__e==s&&s.parentNode!=e&&(s=d(m))}return h++,n})),t.__e=v,null!=o&&"function"!=typeof t.type)for(h=o.length;h--;)null!=o[h]&&u(o[h]);for(h=x;h--;)null!=w[h]&&k(w[h],w[h]);if(y)for(h=0;h<y.length;h++)A(y[h],y[++h],y[++h])}function T(e,t,n){if(null==n&&(n=[]),null==e||"boolean"==typeof e)t&&n.push(t(null));else if(Array.isArray(e))for(var i=0;i<e.length;i++)T(e[i],t,n);else n.push(t?t("string"==typeof e||"number"==typeof e?h(null,e,null,null,e):null!=e.__e||null!=e.__c?h(e.type,e.props,e.key,null,e.__v):e):e);return n}function w(e,t,n){"-"===t[0]?e.setProperty(t,n):e[t]="number"==typeof n&&!1===_.test(t)?n+"px":null==n?"":n}function x(e,t,n,i,r){var o,l,a,_,s;if(r?"className"===t&&(t="class"):"class"===t&&(t="className"),"style"===t)if(o=e.style,"string"==typeof n)o.cssText=n;else{if("string"==typeof i&&(o.cssText="",i=null),i)for(_ in i)n&&_ in n||w(o,_,"");if(n)for(s in n)i&&n[s]===i[s]||w(o,s,n[s])}else"o"===t[0]&&"n"===t[1]?(l=t!==(t=t.replace(/Capture$/,"")),a=t.toLowerCase(),t=(a in e?a:t).slice(2),n?(i||e.addEventListener(t,E,l),(e.l||(e.l={}))[t]=n):e.removeEventListener(t,E,l)):"list"!==t&&"tagName"!==t&&"form"!==t&&"type"!==t&&"size"!==t&&!r&&t in e?e[t]=null==n?"":n:"function"!=typeof n&&"dangerouslySetInnerHTML"!==t&&(t!==(t=t.replace(/^xlink:?/,""))?null==n||!1===n?e.removeAttributeNS("http://www.w3.org/1999/xlink",t.toLowerCase()):e.setAttributeNS("http://www.w3.org/1999/xlink",t.toLowerCase(),n):null==n||!1===n&&!/^ar/.test(t)?e.removeAttribute(t):e.setAttribute(t,n))}function E(t){this.l[t.type](e.event?e.event(t):t)}function R(t,n,i,r,o,l,a,_,u){var c,h,d,f,g,v,T,w,x,E,R=n.type;if(void 0!==n.constructor)return null;(c=e.__b)&&c(n);try{e:if("function"==typeof R){if(w=n.props,x=(c=R.contextType)&&r[c.__c],E=c?x?x.props.value:c.__:r,i.__c?T=(h=n.__c=i.__c).__=h.__E:("prototype"in R&&R.prototype.render?n.__c=h=new R(w,E):(n.__c=h=new m(w,E),h.constructor=R,h.render=B),x&&x.sub(h),h.props=w,h.state||(h.state={}),h.context=E,h.__n=r,d=h.__d=!0,h.__h=[]),null==h.__s&&(h.__s=h.state),null!=R.getDerivedStateFromProps&&(h.__s==h.state&&(h.__s=s({},h.__s)),s(h.__s,R.getDerivedStateFromProps(w,h.__s))),f=h.props,g=h.state,d)null==R.getDerivedStateFromProps&&null!=h.componentWillMount&&h.componentWillMount(),null!=h.componentDidMount&&h.__h.push(h.componentDidMount);else{if(null==R.getDerivedStateFromProps&&w!==f&&null!=h.componentWillReceiveProps&&h.componentWillReceiveProps(w,E),!h.__e&&null!=h.shouldComponentUpdate&&!1===h.shouldComponentUpdate(w,h.__s,E)||n.__v===i.__v&&!h.__){for(h.props=w,h.state=h.__s,n.__v!==i.__v&&(h.__d=!1),h.__v=n,n.__e=i.__e,n.__k=i.__k,h.__h.length&&a.push(h),c=0;c<n.__k.length;c++)n.__k[c]&&(n.__k[c].__=n);break e}null!=h.componentWillUpdate&&h.componentWillUpdate(w,h.__s,E),null!=h.componentDidUpdate&&h.__h.push((function(){h.componentDidUpdate(f,g,v)}))}h.context=E,h.props=w,h.state=h.__s,(c=e.__r)&&c(n),h.__d=!1,h.__v=n,h.__P=t,c=h.render(h.props,h.state,h.context),n.__k=null!=c&&c.type==p&&null==c.key?c.props.children:Array.isArray(c)?c:[c],null!=h.getChildContext&&(r=s(s({},r),h.getChildContext())),d||null==h.getSnapshotBeforeUpdate||(v=h.getSnapshotBeforeUpdate(f,g)),y(t,n,i,r,o,l,a,_,u),h.base=n.__e,h.__h.length&&a.push(h),T&&(h.__E=h.__=null),h.__e=!1}else null==l&&n.__v===i.__v?(n.__k=i.__k,n.__e=i.__e):n.__e=S(i.__e,n,i,r,o,l,a,u);(c=e.diffed)&&c(n)}catch(t){n.__v=null,e.__e(t,n,i)}return n.__e}function b(t,n){e.__c&&e.__c(n,t),t.some((function(n){try{t=n.__h,n.__h=[],t.some((function(e){e.call(n)}))}catch(t){e.__e(t,n.__v)}}))}function S(e,t,n,i,r,o,_,s){var u,c,h,p,m,d=n.props,f=t.props;if(r="svg"===t.type||r,null!=o)for(u=0;u<o.length;u++)if(null!=(c=o[u])&&((null===t.type?3===c.nodeType:c.localName===t.type)||e==c)){e=c,o[u]=null;break}if(null==e){if(null===t.type)return document.createTextNode(f);e=r?document.createElementNS("http://www.w3.org/2000/svg",t.type):document.createElement(t.type,f.is&&{is:f.is}),o=null,s=!1}if(null===t.type)d!==f&&e.data!=f&&(e.data=f);else{if(null!=o&&(o=a.slice.call(e.childNodes)),h=(d=n.props||l).dangerouslySetInnerHTML,p=f.dangerouslySetInnerHTML,!s){if(d===l)for(d={},m=0;m<e.attributes.length;m++)d[e.attributes[m].name]=e.attributes[m].value;(p||h)&&(p&&h&&p.__html==h.__html||(e.innerHTML=p&&p.__html||""))}(function(e,t,n,i,r){var o;for(o in n)"children"===o||"key"===o||o in t||x(e,o,null,n[o],i);for(o in t)r&&"function"!=typeof t[o]||"children"===o||"key"===o||"value"===o||"checked"===o||n[o]===t[o]||x(e,o,t[o],n[o],i)})(e,f,d,r,s),p?t.__k=[]:(t.__k=t.props.children,y(e,t,n,i,"foreignObject"!==t.type&&r,o,_,l,s)),s||("value"in f&&void 0!==(u=f.value)&&u!==e.value&&x(e,"value",u,d.value,!1),"checked"in f&&void 0!==(u=f.checked)&&u!==e.checked&&x(e,"checked",u,d.checked,!1))}return e}function A(t,n,i){try{"function"==typeof t?t(n):t.current=n}catch(t){e.__e(t,i)}}function k(t,n,i){var r,o,l;if(e.unmount&&e.unmount(t),(r=t.ref)&&(r.current&&r.current!==t.__e||A(r,null,n)),i||"function"==typeof t.type||(i=null!=(o=t.__e)),t.__e=t.__d=void 0,null!=(r=t.__c)){if(r.componentWillUnmount)try{r.componentWillUnmount()}catch(t){e.__e(t,n)}r.base=r.__P=null}if(r=t.__k)for(l=0;l<r.length;l++)r[l]&&k(r[l],n,i);null!=o&&u(o)}function B(e,t,n){return this.constructor(e,n)}e={__e:function(e,t){for(var n,i;t=t.__;)if((n=t.__c)&&!n.__)try{if(n.constructor&&null!=n.constructor.getDerivedStateFromError&&(i=!0,n.setState(n.constructor.getDerivedStateFromError(e))),null!=n.componentDidCatch&&(i=!0,n.componentDidCatch(e)),i)return g(n.__E=n)}catch(t){e=t}throw e}},m.prototype.setState=function(e,t){var n;n=this.__s!==this.state?this.__s:this.__s=s({},this.state),"function"==typeof e&&(e=e(n,this.props)),e&&s(n,e),null!=e&&this.__v&&(t&&this.__h.push(t),g(this))},m.prototype.forceUpdate=function(e){this.__v&&(this.__e=!0,e&&this.__h.push(e),g(this))},m.prototype.render=p,t=[],n=0,i="function"==typeof Promise?Promise.prototype.then.bind(Promise.resolve()):setTimeout,o=l;function L(e,t,n){const i=e.createShader(n);if(e.shaderSource(i,t),e.compileShader(i),!e.getShaderParameter(i,e.COMPILE_STATUS)){const t=e.getShaderInfoLog(i);throw e.deleteShader(i),Error(t||"unknown error")}return i}function C(e,t){const n=e.createTexture();return e.bindTexture(e.TEXTURE_2D,n),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,t),n}class M extends m{constructor(){super(...arguments),this._canvasRef={}}_setup(){const e=this._canvasRef.current.getContext("webgl",{antialias:!1,powerPreference:"low-power"});if(!e)throw Error("Couldn't create GL context");this._gl=e;const t=function(e,t){const n=e.createProgram();for(const i of t)e.attachShader(n,i);if(e.linkProgram(n),!e.getProgramParameter(n,e.LINK_STATUS)){const t=e.getProgramInfoLog(n);throw e.deleteProgram(n),Error(t||"unknown error")}return n}(e,[L(e,'/**\n* Copyright 2020 Google Inc. All Rights Reserved.\n* Licensed under the Apache License, Version 2.0 (the "License");\n* you may not use this file except in compliance with the License.\n* You may obtain a copy of the License at\n*     http://www.apache.org/licenses/LICENSE-2.0\n* Unless required by applicable law or agreed to in writing, software\n* distributed under the License is distributed on an "AS IS" BASIS,\n* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n* See the License for the specific language governing permissions and\n* limitations under the License.\n*/\nprecision lowp float;\n\n// our textures\nuniform sampler2D u_luma;\nuniform sampler2D u_chroma;\n\n// the texCoords passed in from the vertex shader.\nvarying vec2 v_texCoord;\n\nvoid main() {\n  vec4 lumaRGB = texture2D(u_luma, v_texCoord).rgba;\n  vec4 chromaRGB = texture2D(u_chroma, v_texCoord).rgba;\n  float y = 0.256788235 * lumaRGB.r + 0.504129412 * lumaRGB.g + 0.097905882 * lumaRGB.b + 0.062745098;\n  float cb = -0.148223529 * chromaRGB.r + -0.290992157 * chromaRGB.g + 0.439215686 * chromaRGB.b + 0.501960784;\n  float cr = 0.439215686 * chromaRGB.r + -0.367788235 * chromaRGB.g + -0.071427451 * chromaRGB.b + 0.501960784;\n\n  float yMul = 1.164381 * y;\n\n  gl_FragColor = vec4(\n    yMul + 1.5960195 * cr + -0.8742024,\n    yMul + -0.3917565 * cb + -0.8129655 * cr + 0.5316682,\n    yMul + 2.0172285 * cb + -1.0856326,\n    1\n  );\n}\n',e.FRAGMENT_SHADER),L(e,'/**\n* Copyright 2020 Google Inc. All Rights Reserved.\n* Licensed under the Apache License, Version 2.0 (the "License");\n* you may not use this file except in compliance with the License.\n* You may obtain a copy of the License at\n*     http://www.apache.org/licenses/LICENSE-2.0\n* Unless required by applicable law or agreed to in writing, software\n* distributed under the License is distributed on an "AS IS" BASIS,\n* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n* See the License for the specific language governing permissions and\n* limitations under the License.\n*/\nprecision lowp float;\n\nattribute vec2 a_position;\n\nuniform mat3 u_matrix;\n\nvarying vec2 v_texCoord;\n\nvoid main() {\n   gl_Position = vec4(u_matrix * vec3(a_position, 1), 1);\n\n   // because we\'re using a unit quad we can just use\n   // the same data for our texcoords.\n   v_texCoord = a_position;\n}\n',e.VERTEX_SHADER)]);e.useProgram(t);const n=e.getAttribLocation(t,"a_position"),i=e.getUniformLocation(t,"u_luma");e.uniform1i(i,0);const r=e.getUniformLocation(t,"u_chroma");e.uniform1i(r,1);const o=e.getUniformLocation(t,"u_matrix"),l=e.createBuffer(),a=new Float32Array([0,0,1,0,0,1,0,1,1,0,1,1]);e.bindBuffer(e.ARRAY_BUFFER,l),e.bufferData(e.ARRAY_BUFFER,a,e.STATIC_DRAW),e.enableVertexAttribArray(n),e.vertexAttribPointer(n,2,e.FLOAT,!1,0,0),e.uniformMatrix3fv(o,!1,[2,0,0,0,-2,0,-1,1,1])}_updateLuma(){this._lumaTexture&&this._gl.deleteTexture(this._lumaTexture),this._gl.activeTexture(this._gl.TEXTURE0),this._lumaTexture=C(this._gl,this.props.lumaBmp),this._gl.bindTexture(this._gl.TEXTURE_2D,this._lumaTexture)}_updateChroma(){this._chromaTexture&&this._gl.deleteTexture(this._chromaTexture),this._gl.activeTexture(this._gl.TEXTURE1),this._chromaTexture=C(this._gl,this.props.chromaBmp),this._gl.bindTexture(this._gl.TEXTURE_2D,this._chromaTexture)}_draw(){this._gl.drawArrays(this._gl.TRIANGLES,0,6)}componentDidMount(){this._setup(),this._updateLuma(),this._updateChroma(),this._draw()}componentDidUpdate(e){let t=!1;e.width===this.props.width&&e.height===this.props.height||(t=!0,this._gl.viewport(0,0,this._gl.canvas.width,this._gl.canvas.height)),e.chromaBmp!==this.props.chromaBmp&&(t=!0,this._updateChroma()),e.lumaBmp!==this.props.lumaBmp&&(t=!0,this._updateLuma()),t&&this._draw()}render({width:e,height:t}){return c("canvas",{ref:this._canvasRef,width:e,height:t,style:{width:e/devicePixelRatio+"px",height:t/devicePixelRatio+"px"}})}}async function P(e){return async function(e,t,n){return e.width<=t&&e.height<=n?e:e.width/e.height>t/n?createImageBitmap(e,{resizeWidth:t,resizeQuality:"high"}):createImageBitmap(e,{resizeHeight:n,resizeQuality:"high"})}(e,window.innerWidth*devicePixelRatio,window.innerHeight*devicePixelRatio)}async function D(e,t){return console.log(t,Math.ceil(e.width*t)),1===t?e:createImageBitmap(e,{resizeWidth:Math.ceil(e.width*t)})}!function(t,n,i){var r,_,s;e.__&&e.__(t,n),_=(r=i===o)?null:i&&i.__k||n.__k,t=c(p,null,[t]),s=[],R(n,(r?n:i||n).__k=t,_||l,l,void 0!==n.ownerSVGElement,i&&!r?[i]:_?null:a.slice.call(n.childNodes),s,i||l,r),b(s,t)}(c(class extends m{constructor(){super(...arguments),this.state={lumaMulti:1,chromaMulti:.01},this._resizeTimeout=0,this._rangeTimeout=0,this._onFileChange=async e=>{const t=e.target;if(!t.files||!t.files[0])return;const n=await createImageBitmap(t.files[0]),i=await P(n),[r,o]=await Promise.all([D(i,this.state.lumaMulti),D(i,this.state.chromaMulti)]);this.setState({mainBmp:n,resizedBmp:i,lumaBmp:r,chromaBmp:o})},this._onResize=()=>{clearTimeout(this._resizeTimeout),this._resizeTimeout=setTimeout(async()=>{if(!this.state.mainBmp)return;const e=await P(this.state.mainBmp),[t,n]=await Promise.all([D(e,this.state.lumaMulti),D(e,this.state.chromaMulti)]);this.setState({resizedBmp:e,lumaBmp:t,chromaBmp:n})},100)},this._onChromaChange=e=>{const t=e.target;this.setState({chromaMulti:t.valueAsNumber})},this._onLumaChange=e=>{const t=e.target;this.setState({lumaMulti:t.valueAsNumber})}}componentDidMount(){addEventListener("resize",this._onResize)}componentWillUnmount(){removeEventListener("resize",this._onResize)}componentDidUpdate(e,t){const n={...this.state};n.lumaMulti===t.lumaMulti&&n.chromaMulti===t.chromaMulti||(clearTimeout(this._rangeTimeout),this._rangeTimeout=setTimeout(async()=>{let e,i;n.lumaMulti!==t.lumaMulti&&(e=D(n.resizedBmp,n.lumaMulti)),n.chromaMulti!==t.chromaMulti&&(i=D(n.resizedBmp,n.chromaMulti));const r={};e&&(r.lumaBmp=await e),i&&(r.chromaBmp=await i),this.setState(r)},50))}render({},{resizedBmp:e,lumaBmp:t,chromaBmp:n,chromaMulti:i,lumaMulti:r}){return c("div",null,e&&t&&n&&c(M,{chromaBmp:n,lumaBmp:t,width:e.width,height:e.height}),c("input",{type:"file",onChange:this._onFileChange}),c("div",{style:{bottom:0,left:0,right:0,padding:"50px",display:"grid",position:"absolute"}},c("input",{type:"range",value:r,min:1e-4,max:1,step:"any",onInput:this._onLumaChange}),c("input",{type:"range",value:i,min:1e-4,max:1,step:"any",onInput:this._onChromaChange})))}},null),document.body);
