import{m as t,p as e,h as a,d as s,H as n,a as i}from"./index-3a7b1376.js";class r extends t{constructor(){super(...arguments),this._canvasRef=e()}static getDerivedStateFromProps(t,e){if(t.data===e.data)return null;const a=new ImageData(8,8);for(let e=0;e<t.data.length;e++)a.data[4*e]=t.data[e],a.data[4*e+1]=t.data[e],a.data[4*e+2]=t.data[e],a.data[4*e+3]=255;return{data:t.data,imageData:a}}_renderData(){this._ctx.putImageData(this.state.imageData,0,0)}componentDidMount(){this._ctx=this._canvasRef.current.getContext("2d"),this._renderData()}componentDidUpdate(t){this.props.data!==t.data&&this._renderData()}render({}){return a("canvas",{class:"_canvas_1bxlg_1",ref:this._canvasRef,width:"8",height:"8"})}}const o=[0,1,5,6,14,15,27,28,2,4,7,13,16,26,29,42,3,8,12,17,25,30,41,43,9,11,18,24,31,40,44,53,10,19,23,32,39,45,52,54,20,22,33,38,46,51,55,60,21,34,37,47,50,56,59,61,35,36,48,49,57,58,62,63],c=new Uint8Array([0,1,8,16,9,2,3,10,17,24,32,25,18,11,4,5,12,19,26,33,40,48,41,34,27,20,13,6,7,14,21,28,35,42,49,56,57,50,43,36,29,22,15,23,30,37,44,51,58,59,52,45,38,31,39,46,53,60,61,54,47,55,62,63]);class l extends t{constructor(){super(...arguments),this.state={}}static getDerivedStateFromProps(t,e){if(!!Object.entries(t).every(([t,a])=>a===e[t]))return null;const a=t.dctData.slice();for(let e=0;e<a.length;e++)(e<t.start||e>=t.end)&&(a[c[e]]=0);const s=new Uint8Array(64);return function(t,e,a){const s=new Int32Array(64);var n,i,r,c,l,h,d,p,u,_,g=s;for(_=0;_<64;_++)g[_]=t[_]*e[o[_]];for(_=0;_<8;++_){var f=8*_;0!=g[1+f]||0!=g[2+f]||0!=g[3+f]||0!=g[4+f]||0!=g[5+f]||0!=g[6+f]||0!=g[7+f]?(n=5793*g[0+f]+128>>8,i=5793*g[4+f]+128>>8,r=g[2+f],c=g[6+f],l=2896*(g[1+f]-g[7+f])+128>>8,p=2896*(g[1+f]+g[7+f])+128>>8,h=g[3+f]<<4,u=n-i+1>>1,n=n+i+1>>1,i=u,u=3784*r+1567*c+128>>8,r=1567*r-3784*c+128>>8,c=u,u=l-(d=g[5+f]<<4)+1>>1,l=l+d+1>>1,d=u,u=p+h+1>>1,h=p-h+1>>1,p=u,u=n-c+1>>1,n=n+c+1>>1,c=u,u=i-r+1>>1,i=i+r+1>>1,r=u,u=2276*l+3406*p+2048>>12,l=3406*l-2276*p+2048>>12,p=u,u=799*h+4017*d+2048>>12,h=4017*h-799*d+2048>>12,d=u,g[0+f]=n+p,g[7+f]=n-p,g[1+f]=i+d,g[6+f]=i-d,g[2+f]=r+h,g[5+f]=r-h,g[3+f]=c+l,g[4+f]=c-l):(u=5793*g[0+f]+512>>10,g[0+f]=u,g[1+f]=u,g[2+f]=u,g[3+f]=u,g[4+f]=u,g[5+f]=u,g[6+f]=u,g[7+f]=u)}for(_=0;_<8;++_){var m=_;0!=g[8+m]||0!=g[16+m]||0!=g[24+m]||0!=g[32+m]||0!=g[40+m]||0!=g[48+m]||0!=g[56+m]?(n=5793*g[0+m]+2048>>12,i=5793*g[32+m]+2048>>12,r=g[16+m],c=g[48+m],l=2896*(g[8+m]-g[56+m])+2048>>12,p=2896*(g[8+m]+g[56+m])+2048>>12,h=g[24+m],u=n-i+1>>1,n=n+i+1>>1,i=u,u=3784*r+1567*c+2048>>12,r=1567*r-3784*c+2048>>12,c=u,u=l-(d=g[40+m])+1>>1,l=l+d+1>>1,d=u,u=p+h+1>>1,h=p-h+1>>1,p=u,u=n-c+1>>1,n=n+c+1>>1,c=u,u=i-r+1>>1,i=i+r+1>>1,r=u,u=2276*l+3406*p+2048>>12,l=3406*l-2276*p+2048>>12,p=u,u=799*h+4017*d+2048>>12,h=4017*h-799*d+2048>>12,d=u,g[0+m]=n+p,g[56+m]=n-p,g[8+m]=i+d,g[48+m]=i-d,g[16+m]=r+h,g[40+m]=r-h,g[24+m]=c+l,g[32+m]=c-l):(u=5793*s[_+0]+8192>>14,g[0+m]=u,g[8+m]=u,g[16+m]=u,g[24+m]=u,g[32+m]=u,g[40+m]=u,g[48+m]=u,g[56+m]=u)}for(_=0;_<64;++_){var v=128+(g[_]+8>>4);a[_]=v<0?0:v>255?255:v}}(a,t.decodeTable,s),{...t,pixelData:s}}render({},{pixelData:t}){return a(r,{data:t||new Uint8Array(64)})}}class h extends t{constructor(){super(...arguments),this._qualityRef=e(),this._phaseRef=e(),this._onChange=()=>{this.props.onChange({quality:this._qualityRef.current.valueAsNumber,phase:this._phaseRef.current.valueAsNumber})}}render({quality:t,phase:e}){return a("div",{class:"_controls_1njsc_1"},a("div",{class:"_ranges_1njsc_4"},a("label",{for:"quality-range"},"Quality: "),a("input",{id:"quality-range",ref:this._qualityRef,type:"range",value:t,min:1,max:100,onInput:this._onChange}),a("label",{for:"phase-range"},"Phase: "),a("input",{id:"phase-range",ref:this._phaseRef,type:"range",value:e,min:0,max:63,onInput:this._onChange})))}}class d extends t{constructor(){super(...arguments),this.state={selectX:0,selectY:0},this._canvasRef=e(),this._onMove=t=>{const e=t.currentTarget.getBoundingClientRect();this.setState({selectX:8*Math.floor((t.clientX-e.left)/4/8),selectY:8*Math.floor((t.clientY-e.top)/4/8)})},this._onClick=()=>{this.props.onSelect(this._ctx.getImageData(this.state.selectX,this.state.selectY,8,8))}}_updateCanvas(){this._ctx=this._canvasRef.current.getContext("2d"),this._ctx.filter="grayscale(100%)",this._ctx.drawImage(this.props.image,0,0)}componentDidMount(){this._updateCanvas()}componentDidUpdate(t){this.props.image!==t.image&&this._updateCanvas()}render({image:t},{selectX:e,selectY:s}){return a("div",{class:"_imageSelect_1q8nr_1",onMouseMove:this._onMove,onClick:this._onClick},a("canvas",{ref:this._canvasRef,class:"_canvas_1q8nr_5",width:t.width,height:t.height,style:{width:4*t.width,height:4*t.height}}),a("div",{class:"_select_1q8nr_10",style:{"--scale":4,top:4*s+"px",left:4*e+"px"}}))}}const p=new URLSearchParams(location.search),u=new Map([["203","/image-experiments/203-af2641c0.webp"],["curve","/image-experiments/curve-2a305a3c.webp"],...Object.entries(s)]).get(p.get("demo")||"");n(a(class extends t{constructor(){super(),this.state={quality:100,phase:63},this._onControlsChange=t=>{this.setState({quality:t.quality,phase:t.phase}),t.quality!==this.state.quality&&this._updateDCT()},this._onFileChange=async t=>{const e=t.target;e.files&&e.files[0]&&this.setState({selectingImage:await createImageBitmap(e.files[0])})},this._onSelect=t=>{this._loadImage(t)},this._onDrop=t=>{this._openFile(t.files[0])},u&&fetch(u).then(t=>t.blob()).then(t=>this._openFile(t))}_updateDCT(){this.setState(t=>{const e=[...t.data].map(t=>t-128),[a,s]=function(t){var e=0;e=t<50?Math.floor(5e3/t):Math.floor(200-2*t);const a=[16,11,10,16,24,40,51,61,12,12,14,19,26,58,60,55,14,13,16,24,40,57,69,56,14,17,22,29,51,87,80,62,18,22,37,56,68,109,103,77,24,35,55,64,81,104,113,92,49,64,78,87,103,121,120,101,72,92,95,98,112,100,103,99];for(var s=[],n=[],i=0;i<64;i++){var r=Math.floor((a[i]*e+50)/100);r<1?r=1:r>255&&(r=255),s[o[i]]=r}for(var c=[1,1.387039845,1.306562965,1.175875602,1,.785694958,.5411961,.275899379],l=0,h=0;h<8;h++)for(var d=0;d<8;d++)n[l]=1/(s[o[l]]*c[h]*c[d]*8),l++;return[n,s]}(t.quality);return{dctData:function(t,e){const a=t.slice();var s,n,i,r,o,c,l,h,d,p=0;for(d=0;d<8;++d){s=a[p],n=a[p+1],i=a[p+2],r=a[p+3],o=a[p+4],c=a[p+5],l=a[p+6];var u=s+(h=a[p+7]),_=s-h,g=n+l,f=n-l,m=i+c,v=i-c,y=r+o,D=r-o,C=u+y,x=u-y,w=g+m,b=g-m;a[p]=C+w,a[p+4]=C-w;var q=.707106781*(b+x);a[p+2]=x+q,a[p+6]=x-q;var I=.382683433*((C=D+v)-(b=f+_)),R=.5411961*C+I,S=1.306562965*b+I,M=.707106781*(w=v+f),T=_+M,A=_-M;a[p+5]=A+R,a[p+3]=A-R,a[p+1]=T+S,a[p+7]=T-S,p+=8}for(p=0,d=0;d<8;++d){s=a[p],n=a[p+8],i=a[p+16],r=a[p+24],o=a[p+32],c=a[p+40],l=a[p+48];var F=s+(h=a[p+56]),U=s-h,j=n+l,X=n-l,Y=i+c,P=i-c,k=r+o,B=r-o,N=F+k,O=F-k,E=j+Y,L=j-Y;a[p]=N+E,a[p+32]=N-E;var Q=.707106781*(L+O);a[p+16]=O+Q,a[p+48]=O-Q;var z=.382683433*((N=B+P)-(L=X+U)),G=.5411961*N+z,H=1.306562965*L+z,J=.707106781*(E=P+X),K=U+J,V=U-J;a[p+40]=V+G,a[p+24]=V-G,a[p+8]=K+H,a[p+56]=K-H,p++}const W=Array(a.length);var Z;for(d=0;d<64;++d)Z=a[d]*e[d],W[d]=Z>0?Z+.5|0:Z-.5|0;return W}(e,a),decodeTable:s}})}async _openFile(t){const e=await createImageBitmap(t);if(e.width>8||e.height>8)return void this.setState({selectingImage:e});const a=document.createElement("canvas");a.width=a.height=8;const s=a.getContext("2d");s.drawImage(e,0,0),this._loadImage(s.getImageData(0,0,8,8))}_loadImage(t){const e=new Uint8Array(64);for(let a=0;a<e.length;a++)e[a]=t.data[4*a];this.setState({data:e,selectingImage:void 0}),this._updateDCT()}render({},{data:t,quality:e,phase:s,dctData:n,decodeTable:o,selectingImage:p}){return a("file-drop",{class:"_app_7673e_11",accept:"image/*",onfiledrop:this._onDrop},t||p?p?a(d,{onSelect:this._onSelect,image:p}):a(i,null,a("div",{class:"_images_7673e_41"},a(r,{data:t}),a(l,{start:0,end:s+1,dctData:n,decodeTable:o})),a("div",{class:"_phases_7673e_56"},n.map((t,e)=>a("div",{class:"_phase_7673e_56",style:{opacity:e>s?.5:1}},a(l,{start:e,end:e+1,dctData:n,decodeTable:o}),a("span",null,0===n[c[e]]?"0":"")))),a(h,{quality:e,phase:s,onChange:this._onControlsChange})):a("input",{type:"file",accept:"image/*",onChange:this._onFileChange}))}},null),document.body);
